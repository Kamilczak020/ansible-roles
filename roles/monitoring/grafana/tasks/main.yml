- name: Create datasource config
  become: yes
  become_user: "{{ system_user }}"
  k8s:
    state: present
    definition: "{{ lookup('template', 'datasource-config.j2') }}"

- name: Create deployment
  become: yes
  become_user: "{{ system_user }}"
  k8s:
    state: present
    definition: "{{ lookup('template', 'deployment.j2') }}"

- name: Create service
  become: yes
  become_user: "{{ system_user }}"
  k8s:
    state: present
    definition: "{{ lookup('template', 'service.j2') }}"

- name: Enable dashboard port on ufw
  become: yes
  ufw:
    rule: allow
    proto: tcp
    to_port: "{{ grafana_port }}"